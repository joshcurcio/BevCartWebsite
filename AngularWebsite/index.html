<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://cdn.firebase.com/js/client/2.4.1/firebase.js"></script>
<script src="https://cdn.firebase.com/libs/angularfire/1.1.3/angularfire.min.js"></script>
<script src="controllers/indexController.js"></script>
<script src="controllers/userController.js"></script>

<head>
	<title>BevCart Home</title>
		<meta charset="utf-8">
		<link href="css/style.css" rel='stylesheet' type='text/css' />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
		<!--webfonts-->
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:600italic,400,300,600,700' rel='stylesheet' type='text/css'>
		<!--//webfonts-->
</head>

<body ng-app="bevcartApp" ng-controller="indexController">
    <div ng-if="isAuthenticated == false" class="login-form">
        <form>
            <img src="images/beverageCart.png" alt=""/><br/>&nbsp;
            <li>
                <input type="text" ng-model="username" placeholder="Username">
                <a href="#" class=" icon user"></a>
            </li>
            <li>
                <input type="password" ng-model="password" placeholder="Password">
            </li>
            <div align="center">
                <input type="submit" ng-click="login()" value="SIGN IN">
            </div>
        </form>
    </div>
    <div ng-if="isAuthenticated == true">

        <h1>Welcome {{ userEmail }} - {{ role }}</h1>
        <button ng-click="logout()">logout</button>

        <div id="main" ng-if="role == 'user'" ng-controller="userController">

          <script src="https://checkout.stripe.com/checkout.js"></script>
          <script>
          var handler = StripeCheckout.configure({
            key: 'pk_test_Fl7f4dTgK6cFSuhJxjT1i19p',
            image: '/img/documentation/checkout/marketplace.png',
            locale: 'auto',
            token: function(token)
            {
              var scope = angular.element(document.getElementById("main")).scope();
              scope = scope.$$childHead;

              var cost = scope.numOfBeer * 250 + scope.numOfHotDogs * 150 + scope.numOfBurgers * 300 + scope.numOfChips * 100;

              console.log(cost);

            	$.post( "http://localhost:3000/checkout", { stripeToken: token.id, amount: cost }, function(result)
            	{
        			console.log(result);
        			if(result == 'success')
        			{
        				//reset form
        				console.log("in reset");

        				//save to firebase
        				scope.newServiceRequest(cost);
								scope.reset();

        			}
        			else
        			{
        				console.log("blah");
        			}
    			});
		      // Use the token to create the charge with a server-side script.
		      // You can access the token ID with `token.id`
		    }
		  });
		  function purchaseButtonPressed()
		  {
		  	var scope = angular.element(document.getElementById("main")).scope();
		  	scope = scope.$$childHead;

        var orderQuant = 0 * scope.numOfBeer + scope.numOfHotDogs + scope.numOfBurgers + scope.numOfChips;
		  	var cost = scope.numOfBeer * 250 + scope.numOfHotDogs * 150 + scope.numOfBurgers * 300 + scope.numOfChips * 100;

		    handler.open({
		      name: 'BevCart Checkout: ' + 'Beverage and Food',
		      description: "Order Size: " + orderQuant,
		      amount: cost
		    });
		  }
		  // Close Checkout on page navigation
		  $(window).on('popstate', function() {
		    handler.close();
		  });
		</script>

            <h1>{{ value }}</h1>
            <div>
                <form novalidate style="background-color:">
                    <h2> Beverage Cart Order: </h2>
                    <br> Beer:
                    <input type="text" ng-model="numOfBeer">
                    <br> Hot Dogs:
                    <input type="text" ng-model="numOfHotDogs">
                    <br> Burgers:
                    <input type="text" ng-model="numOfBurgers">
                    <br> Chips:
                    <input type="text" ng-model="numOfChips">
                    <br> Hole Number:
                    <input type="text" ng-model="holeNumber">
                    <br>
                    <button ng-if="numOfBeer > 0" onclick="purchaseButtonPressed()">Purchase</button>
                </form>
            </div>
            <div>
                <h3>Pending Requests (no provider yet)</h3>
                <ul>
                    <li ng-repeat="obj in service_request_data | filter:{ provider: 'n/a'}">{{ obj.name }}</li>
                </ul>
            </div>
            <div>
                <h3>Incomplete Jobs</h3>
                <ul>
                    <li ng-repeat="obj in service_request_data | filter:{ completed: false, provider: '!n/a'}">{{ obj.name }} ({{ obj.provider}})</li>
                </ul>
            </div>
            <div>
                <h3>Completed Jobs</h3>
                <ul>
                    <li ng-repeat="obj in service_request_data | filter:{ completed: true}">{{ obj.name }} ({{ obj.provider}})</li>
                </ul>
            </div>
        </div>
    </div>
</body>

</html>
